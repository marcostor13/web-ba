---
interface Props {
  formId: string;
  isModal?: boolean;
}

const { formId, isModal = false } = Astro.props;

// Unique IDs for inputs to avoid conflicts when multiple forms exist
const getNameId = (id: string) => `${id}-${formId}`;
---

<form id={formId} class="flex flex-col gap-10 contact-form-instance">
  <!-- Name -->
  <div class="flex flex-col gap-2 relative group">
    <input 
      type="text" 
      id={getNameId('name')} 
      name="name" 
      placeholder="First and last name"
      required
      class="bg-transparent border-b border-black-soft/20 py-3 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 placeholder:text-black-soft/40 font-light"
    />
    <span class="error-msg text-[10px] text-red-500 absolute -bottom-5 left-0 opacity-0 transition-opacity">This field is required</span>
  </div>

  <!-- Email -->
  <div class="flex flex-col gap-2 relative group">
    <input 
      type="email" 
      id={getNameId('email')} 
      name="email" 
      placeholder="Email address"
      required
      class="bg-transparent border-b border-black-soft/20 py-3 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 placeholder:text-black-soft/40 font-light"
    />
    <span class="error-msg text-[10px] text-red-500 absolute -bottom-5 left-0 opacity-0 transition-opacity">Please enter a valid email</span>
  </div>

  <!-- Phone -->
  <div class="flex flex-col gap-2 relative group">
    <input 
      type="tel" 
      id={getNameId('phone')} 
      name="phone" 
      placeholder="Phone number"
      required
      class="bg-transparent border-b border-black-soft/20 py-3 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 placeholder:text-black-soft/40 font-light"
    />
    <span class="error-msg text-[10px] text-red-500 absolute -bottom-5 left-0 opacity-0 transition-opacity">Format: (555) 000-0000</span>
  </div>

  <!-- Address -->
  <div class="flex flex-col gap-2 relative group">
    <input 
      type="text" 
      id={getNameId('address')} 
      name="address" 
      placeholder="Address"
      required
      class="bg-transparent border-b border-black-soft/20 py-3 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 placeholder:text-black-soft/40 font-light"
    />
  </div>

  <!-- Remodeling Needs -->
  <div class="flex flex-col gap-2 relative group">
    <select 
      id={getNameId('needs')} 
      name="needs" 
      required
      class="bg-transparent border-b border-black-soft/20 py-3 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 appearance-none font-light cursor-pointer"
    >
      <option value="" disabled selected>Select your remodeling needs</option>
      <option value="Kitchen Remodel">Kitchen Remodel</option>
      <option value="Master Bathroom Remodel">Master Bathroom Remodel</option>
      <option value="Hall Bathroom Remodel - Keep Tub">Hall Bathroom Remodel - Keep Tub</option>
      <option value="Hall Bathroom Remodel - Tub to Walk-in Shower">Hall Bathroom Remodel - Tub to Walk-in Shower</option>
      <option value="Jack and Jill Remodel">Jack and Jill Remodel</option>
      <option value="Powder Room Remodel">Powder Room Remodel</option>
      <option value="New Addition">New Addition</option>
      <option value="Exterior Work">Exterior Work</option>
    </select>
    <div class="absolute right-0 bottom-4 pointer-events-none">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-black-soft/40">
        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
      </svg>
    </div>
  </div>

  <!-- File Upload Placeholder -->
  <div class="flex flex-col gap-2 relative group">
    <div class="flex justify-between items-center bg-transparent border-b border-black-soft/20 py-3 cursor-pointer group-hover:border-gold transition-colors">
      <span class="text-black-soft/40 font-light text-[16px]">Include a minimum of 3 photographs of the existing layout</span>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-black-soft/40">
        <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94a3 3 0 1 1 4.243 4.243L8.567 17.822a1.5 1.5 0 0 1-2.122-2.122l7.879-7.879" />
      </svg>
    </div>
    <input type="file" multiple class="absolute inset-0 opacity-0 cursor-pointer" />
  </div>

  <!-- Hear About Us -->
  <div class="flex flex-col gap-2 relative group">
    <select 
      id={getNameId('source')} 
      name="source" 
      required
      class="bg-transparent border-b border-black-soft/20 py-3 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 appearance-none font-light cursor-pointer"
    >
      <option value="" disabled selected>How did you hear about us?</option>
      <option value="Referral">Referral</option>
      <option value="Google Search">Google Search</option>
      <option value="Instagram">Instagram</option>
      <option value="Facebook">Facebook</option>
      <option value="TikTok">TikTok</option>
      <option value="Networking Event">Networking Event</option>
      <option value="Newsletter">Newsletter</option>
      <option value="Branded Vehicle">Branded Vehicle</option>
      <option value="Other">Other</option>
    </select>
    <div class="absolute right-0 bottom-4 pointer-events-none">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-black-soft/40">
        <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
      </svg>
    </div>
  </div>

  <!-- Message -->
  <div class="flex flex-col gap-4">
    <label for={getNameId('message')} class="text-black-soft/60 font-light">Message</label>
    <textarea 
      id={getNameId('message')} 
      name="message" 
      placeholder="Share your project detailsâ€¦" 
      rows="5"
      required
      class="bg-transparent border border-black-soft/20 p-4 text-black-soft focus:outline-none focus:border-gold transition-colors duration-300 placeholder:text-black-soft/40 font-light resize-none"
    ></textarea>
  </div>

  <!-- Submit -->
  <div class={`${isModal ? 'flex justify-center' : ''}`}>
    <button 
      type="submit" 
      class="text-gold text-[15px] uppercase tracking-widest font-medium border-b border-gold pb-1 hover:opacity-70 transition-opacity"
    >
      Submit
    </button>
  </div>
</form>

<script define:vars={{ formId }}>
  const initForm = (id) => {
    const form = document.getElementById(id);
    if (!form) return;
    
    // Find phone input within this form
    const phoneInput = form.querySelector('input[type="tel"]');

    // Phone Masking (US Format)
    phoneInput?.addEventListener('input', (e) => {
        let x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
        e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
    });

    // Validation
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        let isValid = true;

        // Simple validation loop
        const inputs = form.querySelectorAll('input[required], select[required], textarea[required]');
        inputs.forEach((input) => {
            const errorMsg = input.parentElement?.querySelector('.error-msg');
            if (!input.value || (input.type === 'email' && !input.value.includes('@'))) {
                errorMsg?.classList.remove('opacity-0');
                input.classList.add('border-red-500');
                isValid = false;
            } else {
                errorMsg?.classList.add('opacity-0');
                input.classList.remove('border-red-500');
            }
        });

        if (isValid) {
            alert('Thank you! Your message has been sent.');
            form.reset();
        }
    });
  };

  // Initialize specifically this form instance
  // We use requestAnimationFrame to ensure DOM is ready if it's dynamic, 
  // or just run it immediately if defer is on.
  initForm(formId);
</script>
